{
  "name": "Overwatch Script To Workshop",
  "scopeName": "source.del",
  "fileTypes": [
    "del",
    "ostw",
    "workshop"
  ],
  "$schema": "https://raw.githubusercontent.com/Septh/tmlanguage/master/tmLanguage.schema.json",
  "patterns": [
    {
      "include": "#rule-set"
    }
  ],
  "repository": {
    "rule-set": {
      "patterns": [
        {
          "include": "#rule"
        },
        {
          "include": "#declare-function"
        },
        {
          "include": "#declare-variable"
        }
      ]
    },
    "type-matcher": {
      "patterns": [
        {
          "match": "define",
          "name": "keyword.other"
        },
        {
          "match": "([_[:alnum:]]+)",
          "name": "entity.name.type"
        },
        {
          "match": "\\[",
          "name": "punctuation.squarebracket.open"
        },
        {
          "match": "\\]",
          "name": "punctuation.squarebracket.close"
        },
        {
          "match": "<",
          "name": "punctuation.definition.typeparameters.begin"
        },
        {
          "match": ">",
          "name": "punctuation.definition.typeparameters.end"
        }
      ]
    },
    "declare-variable": {
      "begin": "(?<set-type>(define|([_[:alnum:]]+))\\b\\s*(<\\s*\\g<set-type>?\\s*>)?\\s*(\\[\\s*\\])*)\\s*([_[:alnum:]]+)\\s*(=)?(?!\\s*\\()",
      "end": ";",
      "patterns": [
        {
          "include": "#expression"
        }
      ],
      "beginCaptures": {
        "1": {
          "patterns": [
            {
              "include": "#type-matcher"
            }
          ]
        },
        "6": {
          "name": "variable"
        },
        "7": {
          "name": "keyword.operator.assignment.ostw"
        }
      },
      "endCaptures": {
        "0": {
          "name": "punctuation.terminator.statement.ostw"
        }
      }
    },
    "declare-function": {
      "begin": "((public|private|protected|virtual|override|abstract|static)\\s+)*(?<set-type>(define|([_[:alnum:]]+))\\b\\s*(<\\s*\\g<set-type>?\\s*>)?\\s*(\\[\\s*\\])*)\\s*([_[:alnum:]]+)\\s*(?=\\()",
      "end": "(?<=})|(?<=;)",
      "beginCaptures": {
        "2": {
          "name": "storage.modifier"
        },
        "3": {
          "patterns": [
            {
              "include": "#type-matcher"
            }
          ]
        },
        "8": {
          "name": "entity.name.function"
        }
      },
      "patterns": [
        {
          "include": "#parameter-list-declaration"
        }
      ]
    },
    "parameter-list-declaration": {
      "begin": "\\(",
      "end": "\\)",
      "endCaptures": {
        "0": {
          "name": "punctuation.parenthesis.close"
        }
      },
      "patterns": [
        {
          "include": "#parameter-declaration"
        }
      ]
    },
    "parameter-declaration": {
      "match": "(ref\\s+)?(?<set-type>(define|([_[:alnum:]]+))\\b\\s*(<\\s*\\g<set-type>?\\s*>)?\\s*(\\[\\s*\\])*)\\s*([_[:alnum:]]+)",
      "captures": {
        "1": {
          "name": "storage.modifier"
        },
        "2": {
          "patterns": [
            {
              "include": "#type-matcher"
            }
          ]
        },
        "7": {
          "name": "variable.parameter"
        }
      }
    },
    "rule": {
      "begin": "(rule)\\s*(:)\\s*(\".*?\")",
      "end": "(?<=})|(?<=;)",
      "beginCaptures": {
        "1": {
          "name": "keyword.control"
        },
        "2": {
          "name": "punctuation.separator.colon"
        },
        "3": {
          "name": "string.quoted.double"
        }
      },
      "patterns": [
        {
          "match": "(Event|Team|Player)\\s*(\\.)\\s*([_[:alnum:]]+)",
          "captures": {
            "1": {
              "name": "support.type"
            },
            "2": {
              "name": "punctuation.accessor"
            },
            "3": {
              "name": "support.variable"
            }
          }
        },
        {
          "begin": "(if)\\s*(\\()",
          "end": "\\)",
          "beginCaptures": {
            "1": {
              "name": "keyword.control.conditional.if"
            },
            "2": {
              "name": "punctuation.parenthesis.open"
            }
          },
          "endCaptures": {
            "0": {
              "name": "punctuation.parenthesis.close"
            }
          },
          "patterns": [
            {
              "include": "#expression"
            }
          ]
        },
        {
          "include": "#block"
        }
      ]
    },
    "block": {
      "begin": "{",
      "end": "}"
    },
    "expression": {
      "patterns": [
        {
          "include": "#number"
        }
      ]
    },
    "number": {
      "patterns": [
        {
          "match": "\\b-?[0-9]+(\\.[0-9]+)?\\b",
          "name": "constant.numeric"
        }
      ]
    }
  }
}