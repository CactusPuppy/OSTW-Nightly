{
  "name": "Overwatch Script To Workshop",
  "scopeName": "source.del",
  "fileTypes": [
    "del",
    "ostw",
    "workshop"
  ],
  "$schema": "https://raw.githubusercontent.com/Septh/tmlanguage/master/tmLanguage.schema.json",
  "patterns": [
    {
      "include": "#rule-set"
    }
  ],
  "repository": {
    "rule-set": {
      "patterns": [
        {
          "include": "#rule"
        },
        {
          "include": "#declare-function"
        },
        {
          "include": "#declare-variable"
        }
      ]
    },
    "type-matcher": {
      "patterns": [
        {
          "match": "define",
          "name": "keyword.other"
        },
        {
          "match": "([_[:alnum:]]+)",
          "name": "entity.name.type"
        },
        {
          "match": "\\[",
          "name": "punctuation.squarebracket.open"
        },
        {
          "match": "\\]",
          "name": "punctuation.squarebracket.close"
        },
        {
          "match": "<",
          "name": "punctuation.definition.typeparameters.begin"
        },
        {
          "match": ">",
          "name": "punctuation.definition.typeparameters.end"
        },
        {
          "match": ",",
          "name": "punctuation.separator.comma"
        }
      ]
    },
    "declare-variable": {
      "begin": "(?<set-type>([_[:alnum:]]+)\\b\\s*(<\\s*(\\s*,?\\s*\\g<set-type>\\s*)*>)?\\s*(\\[\\s*\\])*)\\s*([_[:alnum:]]+)\\s*(=)?(?!\\s*\\()",
      "end": ";",
      "patterns": [
        {
          "include": "#expression"
        }
      ],
      "beginCaptures": {
        "1": {
          "patterns": [
            {
              "include": "#type-matcher"
            }
          ]
        },
        "6": {
          "name": "variable"
        },
        "7": {
          "name": "keyword.operator.assignment.ostw"
        }
      },
      "endCaptures": {
        "0": {
          "name": "punctuation.terminator.statement.ostw"
        }
      }
    },
    "declare-function": {
      "begin": "((public|private|protected|virtual|override|abstract|static)\\s+)*(?<set-type>([_[:alnum:]]+)\\b\\s*(<\\s*(\\s*,?\\s*\\g<set-type>\\s*)*>)?\\s*(\\[\\s*\\])*)\\s*([_[:alnum:]]+)\\s*(?=\\(|:)",
      "end": "(?<=})|(?<=;)",
      "beginCaptures": {
        "2": {
          "name": "storage.modifier"
        },
        "3": {
          "patterns": [
            {
              "include": "#type-matcher"
            }
          ]
        },
        "8": {
          "name": "entity.name.function"
        }
      },
      "patterns": [
        {
          "include": "#parameter-list-declaration"
        },
        {
          "include": "#block"
        },
        {
          "include": "#macro-value"
        }
      ]
    },
    "parameter-list-declaration": {
      "begin": "\\(",
      "end": "\\)",
      "endCaptures": {
        "0": {
          "name": "punctuation.parenthesis.close"
        }
      },
      "patterns": [
        {
          "include": "#parameter-declaration"
        }
      ]
    },
    "parameter-declaration": {
      "match": "(ref\\s+)?(?<set-type>([_[:alnum:]]+)\\b\\s*(<\\s*(\\s*,?\\s*\\g<set-type>\\s*)*>)?\\s*(\\[\\s*\\])*)\\s*([_[:alnum:]]+)",
      "captures": {
        "1": {
          "name": "storage.modifier"
        },
        "2": {
          "patterns": [
            {
              "include": "#type-matcher"
            }
          ]
        },
        "7": {
          "name": "variable.parameter"
        }
      }
    },
    "macro-value": {
      "begin": ":",
      "end": ";",
      "beginCaptures": {
        "0": {
          "name": "punctuation.separator"
        }
      },
      "endCaptures": {
        "0": {
          "name": "punctuation.terminator.statement.ostw"
        }
      },
      "patterns": [
        {
          "include": "#expression"
        }
      ]
    },
    "rule": {
      "begin": "(rule)\\s*(:)\\s*(\\\"(?:[^\"\\\\]|\\\\.)*\\\")",
      "end": "(?<=})|(?<=;)",
      "beginCaptures": {
        "1": {
          "name": "keyword.control"
        },
        "2": {
          "name": "punctuation.separator.colon"
        },
        "3": {
          "name": "string.quoted.double"
        }
      },
      "patterns": [
        {
          "match": "(Event|Team|Player)\\s*(\\.)\\s*([_[:alnum:]]+)",
          "captures": {
            "1": {
              "name": "support.type"
            },
            "2": {
              "name": "punctuation.accessor"
            },
            "3": {
              "name": "support.variable"
            }
          }
        },
        {
          "begin": "(if)\\s*(\\()",
          "end": "\\)",
          "beginCaptures": {
            "1": {
              "name": "keyword.control.conditional.if"
            },
            "2": {
              "name": "punctuation.parenthesis.open"
            }
          },
          "endCaptures": {
            "0": {
              "name": "punctuation.parenthesis.close"
            }
          },
          "patterns": [
            {
              "include": "#expression"
            }
          ]
        },
        {
          "include": "#block"
        }
      ]
    },
    "block": {
      "begin": "{",
      "end": "}",
      "beginCaptures": {
        "0": {
          "name": "punctuation.curlybrace.open"
        }
      },
      "endCaptures": {
        "0": {
          "name": "punctuation.curlybrace.close"
        }
      },
      "patterns": [
        {
          "include": "#statement"
        }
      ]
    },
    "statement": {
      "patterns": [
        {
          "begin": "return",
          "end": ";",
          "beginCaptures": {
            "0": {
              "name": "keyword.control.flow.return"
            }
          },
          "endCaptures": {
            "0": {
              "name": "punctuation.terminator.statement.ostw"
            }
          },
          "patterns": [
            {
              "include": "#expression"
            }
          ]
        },
        {
          "include": "#function-call"
        }
      ]
    },
    "expression": {
      "patterns": [
        {
          "include": "#number"
        },
        {
          "include": "#boolean"
        },
        {
          "include": "#string"
        },
        {
          "include": "#function-call"
        },
        {
          "include": "#create-array"
        },
        {
          "include": "#ternary-conditional"
        }
      ]
    },
    "number": {
      "patterns": [
        {
          "match": "\\b-?[0-9]+(\\.[0-9]+)?\\b",
          "name": "constant.numeric"
        }
      ]
    },
    "boolean": {
      "match": "(true)|(false)",
      "captures": {
        "1": {
          "name": "constant.language.boolean.true"
        },
        "2": {
          "name": "constant.language.boolean.false"
        }
      }
    },
    "string": {
      "patterns": [
        {
          "match": "\\'(?:[^'\\\\]|\\\\.)*\\'",
          "name": "string.quoted.single"
        },
        {
          "match": "\\\"(?:[^\"\\\\]|\\\\.)*\\\"",
          "name": "string.quoted.double"
        }
      ]
    },
    "function-call": {
      "begin": "(\\.?)\\s*([_[:alnum:]]+)\\s*(\\()",
      "end": "\\)",
      "beginCaptures": {
        "1": {
          "name": "punctuation.accessor"
        },
        "2": {
          "name": "entity.name.function"
        },
        "3": {
          "name": "punctuation.parenthesis.open"
        }
      },
      "endCaptures": {
        "0": {
          "name": "punctuation.parenthesis.close"
        }
      },
      "patterns": [
        {
          "include": "#argument-list"
        }
      ]
    },
    "create-array": {
      "begin": "\\[",
      "end": "\\]",
      "beginCaptures": {
        "0": {
          "name": "punctuation.squarebracket.open"
        }
      },
      "endCaptures": {
        "0": {
          "name": "punctuation.squarebracket.close"
        }
      },
      "patterns": [
        {
          "include": "#expression"
        },
        {
          "match": ",",
          "name": "punctuation.separator.comma"
        }
      ]
    },
    "ternary-conditional": {
      "begin": "\\?",
      "end": ":",
      "beginCaptures": {
        "0": {
          "name": "keyword.operator.conditional.question-mark"
        }
      },
      "endCaptures": {
        "0": {
          "name": "keyword.operator.conditional.colon"
        }
      },
      "patterns": [
        {
          "include": "#expression"
        }
      ]
    },
    "argument-list": {
      "patterns": [
        {
          "include": "#expression"
        },
        {
          "begin": "([_[:alnum:]]+)\\s*(:)",
          "end": "\\s*(?=,|\\))",
          "beginCaptures": {
            "1": {
              "name": "variable.parameter"
            },
            "2": {
              "name": "punctuation.separator.colon"
            }
          },
          "patterns": [
            {
              "include": "#expression"
            }
          ]
        },
        {
          "match": ",",
          "name": "punctuation.separator.comma"
        }
      ]
    }
  }
}